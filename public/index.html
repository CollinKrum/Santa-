<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Ads (unchanged) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7145940911173373" crossorigin="anonymous"></script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Santa's Command Center</title>

  <style>
    /*
      The majority of the base styles were retained from the original
      implementation.  Structural changes were kept minimal so the page
      retains its festive look and feel.  The chat tab and panel have been
      completely removed to satisfy the request.  A unique id was added
      to the advent tab so it can be toggled based on the date.  Sound
      functions have been revised for improved fidelity and reliability.
    */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(to bottom right, #450a0a, #7f1d1d, #14532d);
      min-height: 100vh;
      color: white;
      padding: 20px;
    }
    @keyframes wiggle { 0%,100%{transform:rotate(0)} 25%{transform:rotate(-5deg)} 75%{transform:rotate(5deg)} }
    @keyframes float {
      0% { transform: translateY(-100px) translateX(0); opacity: 0; }
      50% { transform: translateY(50vh) translateX(30px); opacity: 0.2; }
      100% { transform: translateY(110vh) translateX(0); opacity: 0; }
    }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.7} }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }
    .snowflake { position: fixed; top: -50px; color: white; font-size: 20px; opacity: 0.2; pointer-events: none; animation: float linear infinite; z-index: 1; }
    .container { max-width: 800px; margin: 0 auto; position: relative; z-index: 10; }
    .header { text-align: center; margin-bottom: 30px; }
    .header h1 { font-size: clamp(32px, 5vw, 48px); font-weight: bold; margin-bottom: 8px; }
    .santa-icon { display: inline-block; font-size: 64px; animation: wiggle 2s ease-in-out infinite; }
    .subtitle { color: #fecaca; font-size: 18px; }
    .card { background: rgba(255,255,255,.1); backdrop-filter: blur(10px); border-radius: 24px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,.5); }
    .name-input-section { background: linear-gradient(to right, #dc2626, #ef4444, #16a34a); padding: 24px; }
    .name-input-section label { display:block; color:white; font-size:12px; font-weight:bold; letter-spacing:1px; margin-bottom:12px; }
    .name-input-section input { width:100%; padding:16px 20px; border-radius:16px; border:none; font-size:18px; outline:none; }

    .tabs { display:flex; background: rgba(255,255,255,.05); border-bottom:1px solid rgba(255,255,255,.1); }
    .tab { flex:1; padding:20px; text-align:center; cursor:pointer; background:transparent; border:none; color:rgba(255,255,255,.6); font-size:14px; font-weight:600; transition:.3s; position:relative; }
    .tab:hover { color:rgba(255,255,255,.9); }
    .tab.active { color:white; background: rgba(255,255,255,.1); }
    .tab.active::after { content:''; position:absolute; bottom:0; left:0; right:0; height:3px; background: linear-gradient(to right, #dc2626, #16a34a); border-radius:3px 3px 0 0; }
    .tab-icon { display:block; font-size:24px; margin-bottom:4px; }

    .tab-content { padding:24px; min-height:500px; }
    .tab-pane { display:none; }
    .tab-pane.active { display:block; }

    .message-buttons { display:flex; flex-direction:column; gap:12px; }
    .message-btn { display:flex; justify-content:space-between; align-items:center; padding:20px; border-radius:16px; border:none; font-size:16px; font-weight:600; color:white; cursor:pointer; transition: transform .2s; position:relative; }
    .message-btn:hover:not(:disabled){ transform: scale(1.05); }
    .message-btn:active:not(:disabled){ transform: scale(0.95); }
    .message-btn:disabled{ opacity:.6; cursor:not-allowed; transform:none !important; }
    .message-btn.nice{ background: linear-gradient(135deg, #10b981, #059669); }
    .message-btn.naughty{ background: linear-gradient(135deg, #ef4444, #dc2626); }
    .message-btn.neutral{ background: linear-gradient(135deg, #3b82f6, #2563eb); }

    .speaking-indicator { margin-top:16px; padding:16px; background: linear-gradient(135deg, #dc2626, #16a34a); border-radius:16px; text-align:center; font-weight:bold; animation: pulse 1.5s ease-in-out infinite; }

    .generate-btn { width:100%; padding:24px; border-radius:16px; border:none; background: linear-gradient(135deg, #dc2626, #ef4444, #16a34a); color:white; font-size:18px; font-weight:bold; cursor:pointer; margin-bottom:24px; transition: transform .2s; }
    .generate-btn:hover{ transform: scale(1.05); }

    .report-card{ background:white; color:#1f2937; border-radius:20px; overflow:hidden; }
    .report-header{ background: linear-gradient(135deg, #dc2626, #16a34a); color:white; padding:24px; text-align:center; }
    .report-content{ padding:24px; }
    .report-scores{ display:grid; grid-template-columns:1fr 1fr; gap:16px; margin:20px 0; }
    .score-box{ padding:20px; border-radius:16px; text-align:center; }
    .score-box.nice{ background:#d1fae5; }
    .score-box.naughty{ background:#fee2e2; }
    .score-number{ font-size:48px; font-weight:bold; }

    .deeds-section{ background:#f3f4f6; padding:16px; border-radius:12px; margin:16px 0; }

    .cam-grid{ display:grid; grid-template-columns: repeat(2,1fr); gap:12px; }
    @media (min-width:640px){ .cam-grid{ grid-template-columns: repeat(3,1fr); } }
    .cam-button{ padding:20px; border-radius:16px; border:none; color:white; font-weight:bold; cursor:pointer; transition: transform .2s; text-align:center; }
    .cam-button:hover{ transform: scale(1.05); }
    .cam-emoji{ font-size:40px; display:block; margin-bottom:8px; }
    .cam-title{ font-size:14px; display:block; }

    .modal{ display:none; position:fixed; inset:0; background:rgba(0,0,0,.9); z-index:1000; padding:20px; }
    .modal.open{ display:flex; align-items:center; justify-content:center; }
    .modal-content{ width:100%; max-width:1000px; background:#000; border-radius:16px; overflow:hidden; }
    .modal-header{ display:flex; justify-content:space-between; align-items:center; padding:16px; background:#1f1f1f; }
    .close-btn{ background:#dc2626; color:white; border:none; padding:8px 16px; border-radius:8px; cursor:pointer; font-weight:bold; }

    .video-container{ background:#000; display:flex; align-items:center; justify-content:center; min-height:400px; }
    .video-container video{ width:100%; max-height:80vh; object-fit:contain; display:block; }

    .video-controls{ padding:16px; background:#1f1f1f; display:flex; gap:12px; justify-content:center; }
    .control-btn{ background:#374151; color:white; border:none; padding:8px 16px; border-radius:8px; cursor:pointer; font-weight:600; font-size:14px; }
    .control-btn:hover{ background:#4b5563; }

    .footer{ text-align:center; margin-top:40px; opacity:.6; font-size:14px; }
    
    .countdown-banner { 
      background: linear-gradient(135deg, #dc2626, #991b1b); 
      padding: 20px; 
      text-align: center; 
      border-radius: 20px; 
      margin-bottom: 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,.3);
      position: relative;
      overflow: hidden;
    }
    .countdown-banner::before {
      content: '‚ùÑÔ∏è';
      position: absolute;
      font-size: 100px;
      opacity: 0.1;
      left: -20px;
      top: -20px;
      animation: wiggle 3s ease-in-out infinite;
    }
    .countdown-banner::after {
      content: 'üéÑ';
      position: absolute;
      font-size: 100px;
      opacity: 0.1;
      right: -20px;
      bottom: -20px;
      animation: wiggle 3s ease-in-out infinite reverse;
    }
    .countdown-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 12px;
      color: #fecaca;
      letter-spacing: 1px;
      text-transform: uppercase;
    }
    .countdown-display {
      display: flex;
      justify-content: center;
      gap: 16px;
      flex-wrap: wrap;
    }
    .countdown-box {
      background: rgba(255,255,255,.2);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 16px 20px;
      min-width: 80px;
      border: 2px solid rgba(255,255,255,.3);
    }
    .countdown-number {
      font-size: 36px;
      font-weight: bold;
      color: white;
      display: block;
      line-height: 1;
    }
    .countdown-label {
      font-size: 12px;
      color: #fecaca;
      margin-top: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    @keyframes glow {
      0%, 100% { box-shadow: 0 0 20px rgba(220, 38, 38, 0.5); }
      50% { box-shadow: 0 0 40px rgba(220, 38, 38, 0.8); }
    }
    .countdown-banner.christmas-day {
      background: linear-gradient(135deg, #16a34a, #059669);
      animation: glow 2s ease-in-out infinite;
    }
    
    .advent-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 12px;
      padding: 20px;
      background: white;
      border-radius: 20px;
    }
    .advent-day {
      aspect-ratio: 1;
      background: linear-gradient(135deg, #dc2626, #991b1b);
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      border: 3px solid #7f1d1d;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .advent-day:hover:not(.locked):not(.opened) {
      transform: scale(1.05);
      box-shadow: 0 6px 16px rgba(220, 38, 38, 0.4);
    }
    .advent-day.locked {
      background: linear-gradient(135deg, #6b7280, #4b5563);
      cursor: not-allowed;
      opacity: 0.6;
    }
    .advent-day.opened {
      background: linear-gradient(135deg, #16a34a, #059669);
      border-color: #14532d;
    }
    .advent-day.today {
      animation: glow 2s ease-in-out infinite;
      border-color: #fbbf24;
    }
    .advent-number {
      font-size: 28px;
      font-weight: bold;
      color: white;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    .advent-icon {
      font-size: 20px;
      margin-top: 4px;
    }
    .advent-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.9);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .advent-modal.open {
      display: flex;
    }
    .advent-modal-content {
      background: white;
      border-radius: 24px;
      padding: 32px;
      max-width: 500px;
      width: 100%;
      text-align: center;
      position: relative;
      color: #1f2937;
    }
    .advent-close {
      position: absolute;
      top: 16px;
      right: 16px;
      background: #dc2626;
      color: white;
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      font-weight: bold;
    }
    .advent-surprise {
      font-size: 64px;
      margin: 20px 0;
      animation: bounce 1s ease-out;
    }

    /* Daily Christmas Tidbit Card */
    .daily-card{
      background: linear-gradient(135deg,#991b1b,#7f1d1d);
      padding: 18px 20px;
      border-radius: 18px;
      margin: 16px 0 24px 0;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      position: relative;
      overflow: hidden;
    }
    .daily-card::before{
      content:'üéÅ';
      position:absolute; right:-12px; top:-10px; font-size:80px; opacity:.08;
    }
    .daily-title{
      font-size:14px; letter-spacing:1px; text-transform:uppercase;
      color:#fecaca; font-weight:700; margin-bottom:8px;
    }
    .daily-text{ font-size:18px; line-height:1.5; color:#fff; }

    /* North Pole Map styles */
    .map-grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(100px,1fr));
      gap:12px;
      padding: 20px;
    }
    .map-item{
      background: linear-gradient(135deg,#dc2626,#991b1b);
      border-radius: 12px;
      padding: 20px;
      text-align:center;
      color:white;
      cursor:pointer;
      transition: transform .2s;
      box-shadow: 0 4px 8px rgba(0,0,0,.3);
    }
    .map-item:hover{ transform: scale(1.05); }
    .map-icon{ font-size:32px; margin-bottom:6px; }
    .map-name{ font-size:14px; font-weight:bold; }

    /* Info modal for map and other details */
    .info-modal{
      display:none;
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.9);
      z-index:3000;
      align-items:center;
      justify-content:center;
      padding:20px;
    }
    .info-modal.open{ display:flex; }
    .info-modal-content{
      background:white;
      color:#1f2937;
      border-radius:24px;
      padding:32px;
      max-width:600px;
      width:100%;
      position:relative;
      text-align:center;
      overflow-y:auto;
      max-height:80vh;
    }
    .info-close{
      position:absolute;
      top:16px;
      right:16px;
      background:#dc2626;
      color:white;
      border:none;
      width:32px;
      height:32px;
      border-radius:50%;
      cursor:pointer;
      font-size:18px;
      font-weight:bold;
    }

    /* Avatar creator styles */
    .avatar-container{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:20px;
    }
    .avatar-preview{
      background:white;
      border-radius:20px;
      padding:20px;
      box-shadow:0 4px 12px rgba(0,0,0,.3);
      width:180px;
      height:220px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .avatar-controls{
      display:flex;
      flex-direction:column;
      gap:10px;
      width:100%;
      max-width:300px;
    }
    .avatar-controls label{
      display:flex;
      align-items:center;
      justify-content:space-between;
      color:#374151;
      font-weight:600;
      background:#f9fafb;
      padding:10px 14px;
      border-radius:12px;
      border:2px solid #e5e7eb;
    }
    .avatar-controls input[type="color"]{
      width:50px;
      height:30px;
      border:none;
      padding:0;
      cursor:pointer;
    }
    .avatar-name{
      font-size:20px;
      font-weight:bold;
      color:#dc2626;
      margin-top:10px;
    }

    /* Tracker styles */
    .tracker-container{
      margin-top:20px;
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:center;
    }
    .tracker-progress-bar{
      width:100%;
      max-width:500px;
      background:rgba(255,255,255,.2);
      height:20px;
      border-radius:10px;
      overflow:hidden;
    }
    .tracker-progress{
      height:100%;
      width:0%;
      background:linear-gradient(135deg,#10b981,#3b82f6);
      transition:width 0.6s ease-in-out;
    }
    .tracker-status{
      font-size:16px;
      color:white;
      text-align:center;
    }
    .tracker-message{
      font-size:16px;
      color:#fbbf24;
      text-align:center;
    }

    /* Theme customization */
    .theme-options{
      display:flex;
      flex-direction:column;
      gap:20px;
    }
    .theme-grid{
      display:grid;
      grid-template-columns: repeat(auto-fill,minmax(120px,1fr));
      gap:12px;
    }
    .theme-btn{
      padding:16px;
      border:none;
      border-radius:12px;
      color:white;
      font-weight:bold;
      cursor:pointer;
      text-align:center;
      transition:transform .2s;
      box-shadow:0 4px 8px rgba(0,0,0,.3);
    }
    .theme-btn:hover{ transform:scale(1.05); }
    .music-options{
      display:flex;
      gap:10px;
      align-items:center;
    }
    .music-options select{
      flex:1;
      padding:8px 12px;
      border-radius:8px;
      border:2px solid #e5e7eb;
      font-size:14px;
    }
    .music-options button{
      padding:8px 16px;
      border:none;
      border-radius:8px;
      background:linear-gradient(135deg,#dc2626,#16a34a);
      color:white;
      font-weight:bold;
      cursor:pointer;
      transition:transform .2s;
    }
    .music-options button:hover{ transform:scale(1.05); }

    /* Ornament designer styles */
    .ornament-container{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:20px;
    }
    .ornament-preview{
      background:white;
      border-radius:20px;
      padding:20px;
      box-shadow:0 4px 12px rgba(0,0,0,.3);
      width:180px;
      height:220px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .ornament-controls{
      display:flex;
      flex-direction:column;
      gap:12px;
      width:100%;
      max-width:300px;
    }
    .ornament-controls label{
      display:flex;
      align-items:center;
      justify-content:space-between;
      color:#374151;
      font-weight:600;
      background:#f9fafb;
      padding:10px 14px;
      border-radius:12px;
      border:2px solid #e5e7eb;
    }
    .ornament-controls input[type="color"]{
      width:50px;
      height:30px;
      border:none;
      padding:0;
      cursor:pointer;
    }
    .ornament-shapes{
      display:flex;
      gap:12px;
      justify-content:center;
      margin-bottom:12px;
    }
    .ornament-shapes button{
      padding:10px 14px;
      border:none;
      border-radius:12px;
      cursor:pointer;
      font-weight:bold;
      transition:transform .2s;
      background:linear-gradient(135deg,#dc2626,#991b1b);
      color:white;
    }
    .ornament-shapes button.active{
      background:linear-gradient(135deg,#10b981,#059669);
    }

    /* Ornament pattern selector styles */
    .ornament-patterns{
      display:flex;
      gap:12px;
      justify-content:center;
      margin-bottom:12px;
    }
    .ornament-patterns button{
      padding:8px 12px;
      border:none;
      border-radius:12px;
      cursor:pointer;
      font-weight:bold;
      background:linear-gradient(135deg,#dc2626,#991b1b);
      color:white;
      transition: transform .2s;
    }
    .ornament-patterns button:hover{
      transform: scale(1.05);
    }
    .ornament-patterns button.active{
      background:linear-gradient(135deg,#10b981,#059669);
    }

    /* Interactive map styles */
    .map-container{
      position:relative;
      width:100%;
      height:300px;
      border-radius:20px;
      /* Stylized background: snowy ice fading into blue tones to resemble a dreamy North Pole map */
      background: radial-gradient(circle at 50% 50%, #ffffff 0%, #e0f2fe 40%, #bae6fd 75%, #7dd3fc 100%);
      border: 4px solid rgba(255,255,255,0.3);
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
      backdrop-filter: blur(6px);
      overflow:hidden;
    }
    .map-marker{
      position:absolute;
      transform:translate(-50%, -50%);
      display:flex;
      flex-direction:column;
      align-items:center;
      cursor:pointer;
      color:white;
    }
    .map-marker .marker-icon{
      font-size:32px;
      /* Give markers a festive look with a soft gradient and rounded shape */
      background: linear-gradient(135deg,#dc2626,#10b981);
      padding:6px;
      border-radius:50%;
      margin-bottom:2px;
    }
    .map-marker .marker-label{
      font-size:12px;
      text-shadow:1px 1px 2px rgba(0,0,0,0.7);
    }
    /* Additional styles for new interactive experiences */
    /* Snow Globe Explorer styles */
    .globe-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 16px;
    }
    .snow-globe {
      position: relative;
      width: 100px;
      height: 120px;
      border-radius: 50% 50% 40% 40% / 60% 60% 40% 40%;
      overflow: hidden;
      background: radial-gradient(circle at 50% 50%, #ffffff 0%, #e5e7eb 50%, #d1d5db 100%);
      box-shadow: 0 4px 10px rgba(0,0,0,.3);
      cursor: pointer;
      transition: transform .2s;
    }
    .snow-globe:hover { transform: scale(1.05); }
    .globe-inner {
      position: absolute;
      inset: 0;
      overflow: hidden;
    }
    .snow-dot {
      position: absolute;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: rgba(255,255,255,.8);
      animation: floatSnow linear infinite;
    }
    @keyframes floatSnow {
      0% { transform: translateY(100%); opacity: 1; }
      100% { transform: translateY(-150%); opacity: 0; }
    }
    .globe-label {
      position: absolute;
      bottom: -14px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      color: #fff;
      text-align: center;
    }
    /* Cookie Decorator styles */
    .cookie-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }
    .cookie-preview {
      background: white;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,.3);
      width: 180px;
      height: 220px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .cookie-controls {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 100%;
      max-width: 300px;
    }
    .cookie-shapes, .cookie-patterns {
      display: flex;
      gap: 12px;
      justify-content: center;
    }
    .cookie-shapes button, .cookie-patterns button {
      padding: 10px 14px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: bold;
      background: linear-gradient(135deg,#dc2626,#991b1b);
      color: white;
      transition: transform .2s;
    }
    .cookie-shapes button.active, .cookie-patterns button.active {
      background: linear-gradient(135deg,#10b981,#059669);
    }
    /* Reindeer Race styles */
    .race-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 12px;
    }
    .race-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .race-icon {
      font-size: 24px;
    }
    .race-track {
      flex: 1;
      background: rgba(255,255,255,.2);
      height: 16px;
      border-radius: 8px;
      overflow: hidden;
      position: relative;
    }
    .race-progress {
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 0%;
      background: linear-gradient(135deg,#fbbf24,#f97316);
      transition: width 0.3s linear;
    }
    .race-start {
      margin-top: 8px;
      padding: 12px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(135deg,#3b82f6,#2563eb);
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: transform .2s;
    }
    .race-start:hover {
      transform: scale(1.05);
    }
    .race-result {
      margin-top: 8px;
      font-size: 16px;
      color: #fbbf24;
      text-align: center;
    }
    /* Snowflake Maker styles */
    .snowflake-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }
    .snowflake-preview {
      background: white;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,.3);
      width: 180px;
      height: 220px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .snowflake-controls {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 100%;
      max-width: 300px;
    }
    .snowflake-templates {
      display: flex;
      gap: 12px;
      justify-content: center;
    }
    .snowflake-templates button {
      padding: 10px 14px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: bold;
      background: linear-gradient(135deg,#dc2626,#991b1b);
      color: white;
      transition: transform .2s;
    }
    .snowflake-templates button.active {
      background: linear-gradient(135deg,#10b981,#059669);
    }
    /* Quiz styles */
    .quiz-container {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .quiz-question {
      font-size: 18px;
      font-weight: 600;
      color: #dc2626;
    }
    .quiz-options {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .quiz-options button {
      padding: 12px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(135deg,#3b82f6,#2563eb);
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: transform .2s;
      text-align: left;
    }
    .quiz-options button:hover {
      transform: scale(1.03);
    }
    .quiz-feedback {
      font-size: 16px;
      color: #fbbf24;
      text-align: center;
    }
    .quiz-score {
      font-size: 18px;
      color: #10b981;
      text-align: center;
      margin-top: 12px;
    }
    .quiz-restart {
      padding: 12px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(135deg,#dc2626,#16a34a);
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: transform .2s;
      margin-top: 12px;
    }
    .quiz-restart:hover { transform: scale(1.05); }

    /* Reindeer selection buttons */
    .reindeer-select {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-bottom: 12px;
    }
    .reindeer-select button {
      padding: 8px 14px;
      border: none;
      border-radius: 12px;
      font-weight: bold;
      cursor: pointer;
      background: linear-gradient(135deg, #f97316, #ea580c);
      color: white;
      transition: transform .2s;
    }
    .reindeer-select button:hover {
      transform: scale(1.05);
    }
    .reindeer-select button.active {
      background: linear-gradient(135deg, #10b981, #059669);
    }
  </style>
</head>
<body>
  <div id="snowflakes"></div>

  <div class="container">
    <div class="header">
      <div style="position: relative; display: inline-block;">
        <span class="santa-icon">üéÖ</span>
        <span style="position: absolute; top: -10px; right: -10px; font-size: 32px;">‚ú®</span>
      </div>
      <h1>Santa's Command Center</h1>
      <p class="subtitle">Live from the North Pole ‚Ä¢ Powered by ElevenLabs AI</p>

      <!-- Daily Christmas Tidbit -->
      <div id="dailyCard" class="daily-card" aria-live="polite">
        <div class="daily-title">üéÖ Today's Christmas Tidbit</div>
        <div id="dailyText" class="daily-text">Loading‚Ä¶</div>
      </div>
    </div>

    <!-- Countdown to Christmas -->
    <div id="countdownBanner" class="countdown-banner">
      <div class="countdown-title">üéÖ Countdown to Christmas üéÑ</div>
      <div class="countdown-display">
        <div class="countdown-box">
          <span class="countdown-number" id="days">0</span>
          <span class="countdown-label">Days</span>
        </div>
        <div class="countdown-box">
          <span class="countdown-number" id="hours">0</span>
          <span class="countdown-label">Hours</span>
        </div>
        <div class="countdown-box">
          <span class="countdown-number" id="minutes">0</span>
          <span class="countdown-label">Minutes</span>
        </div>
        <div class="countdown-box">
          <span class="countdown-number" id="seconds">0</span>
          <span class="countdown-label">Seconds</span>
        </div>
      </div>
    </div>

    <div class="card">
      <!-- Name Input -->
      <div class="name-input-section">
        <label>CHILD'S NAME</label>
        <input type="text" id="childName" placeholder="Enter name here..." />
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" onclick="switchTab(this,'soundboard')">
          <span class="tab-icon">üîä</span>
          <span>Soundboard</span>
        </button>
        <!-- Chat with Santa has been removed -->
        <button class="tab" onclick="switchTab(this,'report')">
          <span class="tab-icon">üìÑ</span>
          <span>Report Card</span>
        </button>
        <button class="tab" onclick="switchTab(this,'letter')">
          <span class="tab-icon">‚úâÔ∏è</span>
          <span>Letter to Santa</span>
        </button>
        <button class="tab" id="adventTab" onclick="switchTab(this,'advent')">
          <span class="tab-icon">üéÅ</span>
          <span>Advent Calendar</span>
        </button>
        <button class="tab" onclick="switchTab(this,'elf')">
          <span class="tab-icon">üßù</span>
          <span>Elf Name</span>
        </button>
        <!-- New feature tabs -->
        <button class="tab" onclick="switchTab(this,'ornament')">
          <span class="tab-icon">üéÑ</span>
          <span>Ornament</span>
        </button>
        <button class="tab" onclick="switchTab(this,'tracker')">
          <span class="tab-icon">üõ∞Ô∏è</span>
          <span>Tracker</span>
        </button>
        <!-- New interactive experiences -->
        <button class="tab" onclick="switchTab(this,'globes')">
          <span class="tab-icon">üåê</span>
          <span>Globes</span>
        </button>
        <button class="tab" onclick="switchTab(this,'cookies')">
          <span class="tab-icon">üç™</span>
          <span>Cookies</span>
        </button>
        <button class="tab" onclick="switchTab(this,'race')">
          <span class="tab-icon">üèá</span>
          <span>Race</span>
        </button>
        <button class="tab" onclick="switchTab(this,'snowflake')">
          <span class="tab-icon">‚ùÑÔ∏è</span>
          <span>Snowflake</span>
        </button>
        <button class="tab" onclick="switchTab(this,'quiz')">
          <span class="tab-icon">‚ùì</span>
          <span>Quiz</span>
        </button>
        <button class="tab" onclick="switchTab(this,'themes')">
          <span class="tab-icon">üé®</span>
          <span>Themes</span>
        </button>
        <button class="tab" onclick="switchTab(this,'cam')">
          <span class="tab-icon">üìπ</span>
          <span>Santa Cam</span>
        </button>
      </div>

      <!-- Tab Content -->
      <div class="tab-content">
        <!-- Soundboard -->
        <div id="soundboard" class="tab-pane active">
          <div class="message-buttons" id="messageButtons"></div>
          <div id="speakingIndicator" style="display: none;" class="speaking-indicator">üîä Santa is speaking...</div>
        </div>

        <!-- Report Card -->
        <div id="report" class="tab-pane">
          <button class="generate-btn" onclick="generateReport()">‚ú® Generate Report Card</button>
          <div id="reportResult"></div>
        </div>

        <!-- Letter to Santa -->
        <div id="letter" class="tab-pane">
          <div style="background: white; color: #1f2937; border-radius: 20px; padding: 24px; margin-bottom: 20px;">
            <div style="text-align: center; margin-bottom: 20px;">
              <div style="font-size: 48px; margin-bottom: 8px;">üéÖüìÆ</div>
              <h2 style="font-size: 24px; font-weight: bold; color: #dc2626;">Write a Letter to Santa</h2>
              <p style="font-size: 14px; color: #6b7280; margin-top: 8px;">Tell Santa what you'd like for Christmas!</p>
            </div>
            
            <div style="margin-bottom: 16px;">
              <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151;">Your Name:</label>
              <input type="text" id="letterName" placeholder="Enter your name..." style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; outline: none; transition: 0.2s;" onfocus="this.style.borderColor='#dc2626'" onblur="this.style.borderColor='#e5e7eb'" />
            </div>
            
            <div style="margin-bottom: 16px;">
              <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151;">Your Letter:</label>
              <textarea id="letterContent" placeholder="Dear Santa,&#10;&#10;This year I have been very good! For Christmas, I would like...&#10;&#10;Thank you!" style="width: 100%; min-height: 250px; padding: 12px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; font-family: 'Comic Sans MS', cursive; outline: none; resize: vertical; transition: 0.2s;" onfocus="this.style.borderColor='#dc2626'" onblur="this.style.borderColor='#e5e7eb'"></textarea>
            </div>
            
            <div style="display: flex; gap: 12px;">
              <button onclick="saveLetterLocally()" style="flex: 1; padding: 16px; border: none; border-radius: 12px; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; font-size: 16px; font-weight: bold; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                üíæ Save Locally
              </button>
              <button onclick="sendLetterToSanta()" style="flex: 1; padding: 16px; border: none; border-radius: 12px; background: linear-gradient(135deg, #dc2626, #16a34a); color: white; font-size: 16px; font-weight: bold; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                üìÆ Send to Santa
              </button>
            </div>
          </div>
          
          <div id="letterStatus" style="display: none;"></div>
        </div>

        <!-- Elf Name Generator -->
        <div id="elf" class="tab-pane">
          <div style="background: white; color: #1f2937; border-radius: 20px; padding: 24px;">
            <div style="text-align: center; margin-bottom: 24px;">
              <div style="font-size: 64px; margin-bottom: 12px;">üßù‚Äç‚ôÇÔ∏è‚ú®üßù‚Äç‚ôÄÔ∏è</div>
              <h2 style="font-size: 28px; font-weight: bold; color: #16a34a;">Elf Name Generator</h2>
              <p style="font-size: 14px; color: #6b7280; margin-top: 8px;">Discover your official North Pole elf name!</p>
            </div>
            
            <div style="margin-bottom: 20px;">
              <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #374151;">Enter Your Name:</label>
              <input type="text" id="elfNameInput" placeholder="Your name..." style="width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 18px; outline: none; transition: 0.2s;" onfocus="this.style.borderColor='#16a34a'" onblur="this.style.borderColor='#e5e7eb'" />
            </div>
            
            <button onclick="generateElfName()" style="width: 100%; padding: 18px; border: none; border-radius: 12px; background: linear-gradient(135deg, #16a34a, #059669); color: white; font-size: 18px; font-weight: bold; cursor: pointer; transition: transform 0.2s; margin-bottom: 24px;" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
              ‚ú® Generate My Elf Name
            </button>
            
            <div id="elfNameResult" style="display: none;"></div>
          </div>
        </div>

        

        <!-- Ornament Designer -->
        <div id="ornament" class="tab-pane">
          <div style="text-align: center; margin-bottom: 20px;">
            <div style="font-size: 64px; margin-bottom: 12px;">üéÑ‚ú®üß∏</div>
            <h2 style="font-size: 28px; font-weight: bold; color: #16a34a;">Ornament Designer</h2>
            <p style="font-size: 14px; color: #6b7280; margin-top: 8px;">Create your own festive ornament!</p>
          </div>
          <div class="ornament-container">
            <div class="ornament-preview">
              <svg id="ornamentPreview" width="120" height="160" viewBox="0 0 120 160"></svg>
            </div>
            <div class="ornament-controls">
              <div class="ornament-shapes">
                <button type="button" onclick="selectOrnamentShape('ball')" id="shapeBall" class="active">‚ö™ Ball</button>
                <button type="button" onclick="selectOrnamentShape('star')" id="shapeStar">‚≠ê Star</button>
                <button type="button" onclick="selectOrnamentShape('tree')" id="shapeTree">üéÑ Tree</button>
              </div>

              <!-- Ornament pattern selection -->
              <div class="ornament-patterns">
                <button type="button" onclick="selectOrnamentPattern('solid')" id="patternSolid" class="active">Solid</button>
                <button type="button" onclick="selectOrnamentPattern('striped')" id="patternStriped">Stripes</button>
                <button type="button" onclick="selectOrnamentPattern('dotted')" id="patternDotted">Dots</button>
                  <button type="button" onclick="selectOrnamentPattern('paint')" id="patternPaint">Paint</button>
              </div>
                <!-- Brush size control for paint pattern; hidden by default -->
                <label id="brushSizeLabel" style="display:none; align-items:center; justify-content:space-between; color:#374151; font-weight:600; background:#f9fafb; padding:10px 14px; border-radius:12px; border:2px solid #e5e7eb;">
                  Brush Size:
                  <input type="range" id="ornamentBrushSize" min="2" max="10" value="4" oninput="updateOrnamentPreview()" style="flex:1; margin-left:10px;">
                </label>
              <label>
                Base Color:
                <input type="color" id="ornamentBaseColor" value="#ef4444" onchange="updateOrnamentPreview()">
              </label>
              <label>
                Decoration Color:
                <input type="color" id="ornamentDecoColor" value="#fbbf24" onchange="updateOrnamentPreview()">
              </label>
            </div>
          </div>
        </div>

        <!-- Santa Tracker -->
        <div id="tracker" class="tab-pane">
          <div style="text-align: center; margin-bottom: 20px;">
            <h2 style="font-size: 28px; font-weight: bold; margin-bottom: 8px;">üõ∞Ô∏è Santa Tracker</h2>
            <p style="font-size: 14px; opacity: 0.8;">Follow Santa's journey on Christmas Eve!</p>
          </div>
          <div class="tracker-container">
            <div id="trackerMessage" class="tracker-message"></div>
            <div class="tracker-progress-bar">
              <div id="trackerProgress" class="tracker-progress"></div>
            </div>
            <div id="trackerStatus" class="tracker-status"></div>
          </div>
        </div>

        <!-- Themes -->
        <div id="themes" class="tab-pane">
          <div style="text-align: center; margin-bottom: 20px;">
            <h2 style="font-size: 28px; font-weight: bold; margin-bottom: 8px;">üé® Customize Theme</h2>
            <p style="font-size: 14px; opacity: 0.8;">Choose a background theme for your experience!</p>
          </div>
          <div class="theme-options">
            <div>
              <h3 style="font-size: 18px; color: white; margin-bottom: 8px;">Choose a Background</h3>
              <div class="theme-grid">
                <button class="theme-btn" data-theme="classic" onclick="applyTheme('classic')" style="background:linear-gradient(135deg,#dc2626,#16a34a);">Classic</button>
                <button class="theme-btn" data-theme="snowy" onclick="applyTheme('snowy')" style="background:linear-gradient(135deg,#1e3a8a,#6ee7b7);">Snowy Night</button>
                <button class="theme-btn" data-theme="ginger" onclick="applyTheme('ginger')" style="background:linear-gradient(135deg,#b45309,#a16207);">Gingerbread</button>
                <button class="theme-btn" data-theme="candy" onclick="applyTheme('candy')" style="background:linear-gradient(135deg,#ec4899,#f43f5e);">Candy Cane</button>
              </div>
            </div>
            <!-- Background music customization has been removed to simplify the experience -->
          </div>
        </div>
        
        <!-- Snow Globe Explorer -->
        <div id="globes" class="tab-pane">
          <div style="text-align: center; margin-bottom: 20px;">
            <h2 style="font-size: 28px; font-weight: bold; margin-bottom: 8px;">‚ùÑÔ∏è Snow Globe Explorer</h2>
            <p style="font-size: 14px; opacity: 0.8;">Click a snow globe to visit a North Pole location!</p>
          </div>
          <div id="globeGrid" class="globe-grid"></div>
        </div>

        <!-- Cookie Decorating -->
        <div id="cookies" class="tab-pane">
          <div style="text-align: center; margin-bottom: 20px;">
            <div style="font-size: 64px; margin-bottom: 12px;">üç™üé®</div>
            <h2 style="font-size: 28px; font-weight: bold; color: #d97706;">Cookie Decorator</h2>
            <p style="font-size: 14px; color: #6b7280; margin-top: 8px;">Design your own sweet holiday cookie!</p>
          </div>
          <div class="cookie-container">
            <div class="cookie-preview">
              <svg id="cookiePreview" width="120" height="160" viewBox="0 0 120 160"></svg>
            </div>
            <div class="cookie-controls">
              <div class="cookie-shapes">
                <button type="button" onclick="selectCookieShape('round')" id="cookieShapeRound" class="active">‚ö™ Round</button>
                <button type="button" onclick="selectCookieShape('star')" id="cookieShapeStar">‚≠ê Star</button>
                <button type="button" onclick="selectCookieShape('tree')" id="cookieShapeTree">üéÑ Tree</button>
              </div>
              <div class="cookie-patterns">
                <button type="button" onclick="selectCookiePattern('solid')" id="cookiePatternSolid" class="active">Solid</button>
                <button type="button" onclick="selectCookiePattern('striped')" id="cookiePatternStriped">Stripes</button>
                <button type="button" onclick="selectCookiePattern('dotted')" id="cookiePatternDotted">Dots</button>
              </div>
              <label>
                Cookie Color:
                <input type="color" id="cookieBaseColor" value="#f5c16c" onchange="updateCookiePreview()">
              </label>
              <label>
                Frosting Color:
                <input type="color" id="cookieFrostColor" value="#ffffff" onchange="updateCookiePreview()">
              </label>
              <button onclick="saveCookieLocally()" style="padding:12px; margin-top:8px; border:none; border-radius:12px; background:linear-gradient(135deg,#3b82f6,#2563eb); color:white; font-weight:bold; cursor:pointer; transition:transform .2s;">üíæ Save Cookie</button>
            </div>
          </div>
        </div>

        <!-- Reindeer Race Game -->
        <div id="race" class="tab-pane">
          <div style="text-align: center; margin-bottom: 20px;">
            <h2 style="font-size: 28px; font-weight: bold; margin-bottom: 8px;">üèá Reindeer Race</h2>
            <p style="font-size: 14px; opacity: 0.8;">Pick your favorite reindeer and start the race!</p>
          </div>
          <div id="reindeerSelect" class="reindeer-select"></div>
          <div id="raceContainer" class="race-container"></div>
          <button id="raceStartBtn" onclick="startReindeerRace()" class="race-start">Start Race</button>
          <div id="raceResult" class="race-result"></div>
        </div>

        <!-- Snowflake Maker -->
        <div id="snowflake" class="tab-pane">
          <div style="text-align: center; margin-bottom: 20px;">
            <h2 style="font-size: 28px; font-weight: bold; margin-bottom: 8px;">‚ùÑÔ∏è Snowflake Maker</h2>
            <p style="font-size: 14px; opacity: 0.8;">Craft a unique snowflake masterpiece!</p>
          </div>
          <div class="snowflake-container">
            <div class="snowflake-preview">
              <svg id="snowflakePreview" width="140" height="160" viewBox="0 0 140 160"></svg>
            </div>
            <div class="snowflake-controls">
              <div class="snowflake-templates">
                <button type="button" onclick="selectSnowflakeTemplate('simple')" id="flakeSimple" class="active">Template 1</button>
                <button type="button" onclick="selectSnowflakeTemplate('star')" id="flakeStar">Template 2</button>
                <button type="button" onclick="selectSnowflakeTemplate('petal')" id="flakePetal">Template 3</button>
              </div>
              <label>
                Flake Color:
                <input type="color" id="flakeColor" value="#60a5fa" onchange="updateSnowflakePreview()">
              </label>
              <label>
                Accent Color:
                <input type="color" id="flakeAccentColor" value="#ffffff" onchange="updateSnowflakePreview()">
              </label>
              <button type="button" onclick="randomizeSnowflake()" style="padding:12px; margin-top:8px; border:none; border-radius:12px; background:linear-gradient(135deg,#10b981,#059669); color:white; font-weight:bold; cursor:pointer; transition:transform .2s;">üé≤ Randomize</button>
              <button type="button" onclick="saveSnowflakeLocally()" style="padding:12px; margin-top:8px; border:none; border-radius:12px; background:linear-gradient(135deg,#3b82f6,#2563eb); color:white; font-weight:bold; cursor:pointer; transition:transform .2s;">üíæ Save Snowflake</button>
            </div>
          </div>
        </div>

        <!-- Holiday Trivia Quiz -->
        <div id="quiz" class="tab-pane">
          <div style="text-align: center; margin-bottom: 20px;">
            <h2 style="font-size: 28px; font-weight: bold; margin-bottom: 8px;">‚ùì Holiday Quiz</h2>
            <p style="font-size: 14px; opacity: 0.8;">Test your Christmas knowledge!</p>
          </div>
          <div id="quizContent" class="quiz-container"></div>
        </div>

        <!-- Advent Calendar -->
        <div id="advent" class="tab-pane">
          <div style="text-align: center; margin-bottom: 20px;">
            <h2 style="font-size: 28px; font-weight: bold; margin-bottom: 8px;">üéÑ Advent Calendar üéÅ</h2>
            <p style="font-size: 14px; opacity: 0.8;">Open a new surprise each day leading up to Christmas!</p>
          </div>
          <div class="advent-grid" id="adventGrid"></div>
        </div>

        <!-- Santa Cam -->
        <div id="cam" class="tab-pane">
          <div class="cam-grid">
            <button class="cam-button" style="background: linear-gradient(135deg, #d97706, #ea580c);" onclick="openCam('workshop')">
              <span class="cam-emoji">üéÅ</span><span class="cam-title">Workshop</span>
            </button>
            <button class="cam-button" style="background: linear-gradient(135deg, #dc2626, #991b1b);" onclick="openCam('office')">
              <span class="cam-emoji">üìã</span><span class="cam-title">Office</span>
            </button>
            <button class="cam-button" style="background: linear-gradient(135deg, #475569, #334155);" onclick="openCam('stable')">
              <span class="cam-emoji">ü¶å</span><span class="cam-title">Stable</span>
            </button>
            <button class="cam-button" style="background: linear-gradient(135deg, #ec4899, #be185d);" onclick="openCam('kitchen')">
              <span class="cam-emoji">üç™</span><span class="cam-title">Kitchen</span>
            </button>
            <button class="cam-button" style="background: linear-gradient(135deg, #2563eb, #1e40af);" onclick="openCam('mailroom')">
              <span class="cam-emoji">‚úâÔ∏è</span><span class="cam-title">Mail Room</span>
            </button>
            <button class="cam-button" style="background: linear-gradient(135deg, #059669, #047857);" onclick="openCam('lab')">
              <span class="cam-emoji">üß∏</span><span class="cam-title">Toy Lab</span>
            </button>
          </div>
        </div>
      </div>
    </div>


    <div class="footer">
      Made with holiday magic & Christmas spirit<br />
      ¬© 2024 North Pole Technologies
    </div>
  </div>

  <!-- Advent Calendar Modal -->
  <div id="adventModal" class="advent-modal">
    <div class="advent-modal-content">
      <button class="advent-close" onclick="closeAdventModal()">√ó</button>
      <div id="adventSurpriseContent"></div>
    </div>
  </div>

  <!-- Video Modal -->
  <div id="videoModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span id="modalTitle">Santa Cam</span>
        <button class="close-btn" onclick="closeModal()">Close</button>
      </div>
      <div class="video-container">
        <video id="modalVideo" autoplay loop playsinline></video>
      </div>
      <div class="video-controls">
        <button class="control-btn" id="muteBtn" onclick="toggleMute()">üîä Mute</button>
        <button class="control-btn" onclick="restartVideo()">‚Üª Restart</button>
      </div>
    </div>
  </div>

  <!-- The Info Modal has been removed because the map markers now open the Santa Cam directly -->

  <script>
    /**************  COUNTDOWN TO CHRISTMAS  **************/
    function updateCountdown() {
      const now = new Date();
      const currentYear = now.getFullYear();
      
      // Set Christmas date (December 25 at midnight)
      let christmas = new Date(currentYear, 11, 25, 0, 0, 0);
      
      // If Christmas has passed this year, set to next year
      if (now > christmas) {
        christmas = new Date(currentYear + 1, 11, 25, 0, 0, 0);
      }
      
      const diff = christmas - now;
      
      // Calculate time units
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((diff % (1000 * 60)) / 1000);
      
      // Update display
      document.getElementById('days').textContent = days;
      document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
      document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
      document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
      
      // Special handling for Christmas Day
      const banner = document.getElementById('countdownBanner');
      if (days === 0 && hours === 0) {
        banner.classList.add('christmas-day');
        document.querySelector('.countdown-title').textContent = 'üéÖ MERRY CHRISTMAS! üéÑ';
      } else {
        banner.classList.remove('christmas-day');
      }
    }
    
    // Update countdown immediately and every second
    updateCountdown();
    setInterval(updateCountdown, 1000);

    /**************  SOUND EFFECTS  **************/
    // Create audio context for sound effects
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();

    // Ensure the audio context is resumed before playing.  Some browsers
    // suspend the context until a user gesture is registered.
    function ensureAudioContext() {
      if (audioCtx.state === 'suspended') {
        audioCtx.resume();
      }
    }

    // Helper to play a sequence of tones.  Each tone in the array is
    // scheduled back-to-back for a given duration.  This makes the
    // resulting sound more melodic and less like a single beep.
    function playSoundSequence(frequencies, duration) {
      ensureAudioContext();
      const now = audioCtx.currentTime;
      let time = now;
      frequencies.forEach((freq) => {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'sine';
        osc.frequency.setValueAtTime(freq, time);
        gain.gain.setValueAtTime(0.3, time);
        gain.gain.exponentialRampToValueAtTime(0.01, time + duration);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start(time);
        osc.stop(time + duration);
        time += duration;
      });
    }

    // Revised sound effect functions.  These functions now call
    // playSoundSequence with different frequency patterns to better
    // emulate their intended sounds.  The original oscillator-based
    // implementations produced simple beeps that didn't match the
    // descriptions (for example, jingle bells).  These patterns
    // approximate chimes and simple melodies.
    function playJingleBell() {
      // High-pitched bell tones
      playSoundSequence([1500, 2000, 2500], 0.12);
    }

    function playSleighBell() {
      // Slightly lower and more varied frequencies to simulate sleigh bells
      playSoundSequence([800, 1200, 1600], 0.1);
    }

    function playHoHoHo() {
      // Low frequencies to emulate Santa chuckling 'ho ho ho'
      playSoundSequence([220, 180, 200], 0.25);
    }

    function playMagicSparkle() {
      // Rapid ascending tones for a magical sparkle effect
      playSoundSequence([1500, 1700, 1900, 2100, 2300, 2500], 0.06);
    }

    function playSuccess() {
      // A simple triad for success notification (C major chord)
      playSoundSequence([523.25, 659.25, 783.99], 0.15);
    }

    /**************  UTIL & DECORATION  **************/
    // Snowflakes
    const snowflakesContainer = document.getElementById('snowflakes');
    (function makeSnowflakes(){
      for (let i = 0; i < 20; i++) {
        const s = document.createElement('div');
        s.className = 'snowflake';
        s.textContent = '‚ùÑ';
        s.style.left = Math.random() * 100 + '%';
        s.style.animationDelay = Math.random() * 5 + 's';
        s.style.animationDuration = Math.random() * 10 + 15 + 's';
        snowflakesContainer.appendChild(s);
      }
    })();

    // Tabs
    function switchTab(btnEl, tabName) {
      playJingleBell(); // Sound effect when switching tabs
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
      btnEl.classList.add('active');
      document.getElementById(tabName).classList.add('active');
    }

    /**************  SOUNDBOARD + ELEVENLABS TTS  **************/
    let currentAudio = null;

    const messages = [
      { text: "Ho ho ho! You've been very good today, {name}!", type: "nice", emoji: "üéÖ" },
      { text: "{name}, you're on the nice list this year!", type: "nice", emoji: "‚≠ê" },
      { text: "Wonderful job, {name}! Keep up the good work!", type: "nice", emoji: "üåü" },
      { text: "Santa sees you being kind, {name}!", type: "nice", emoji: "üíö" },
      { text: "{name}, I'm watching you... heading towards the naughty list!", type: "naughty", emoji: "üëÄ" },
      { text: "Ho ho... oh no, {name}! Better watch out!", type: "naughty", emoji: "‚ö†Ô∏è" },
      { text: "{name}, that behavior might get you coal for Christmas!", type: "naughty", emoji: "ü™®" },
      { text: "Careful, {name}! You're skating on thin ice!", type: "naughty", emoji: "‚ùÑÔ∏è" },
      { text: "Merry Christmas, {name}! Have a magical holiday!", type: "nice", emoji: "üéÑ" },
      { text: "{name}, have you been naughty or nice this year?", type: "neutral", emoji: "üéÖ" },
    ];

    const messageButtonsContainer = document.getElementById('messageButtons');

    function updateButtonText() {
      const name = (document.getElementById('childName').value || '').trim() || 'little one';
      const buttons = document.querySelectorAll('.message-btn');
      buttons.forEach((btn, idx) => {
        const msg = messages[idx];
        const span = btn.querySelector('.btn-text');
        if (span) span.innerHTML = msg.text.replace(/{name}/g, `<strong>${name}</strong>`);
      });
    }

    // Build buttons
    messages.forEach((msg) => {
      const btn = document.createElement('button');
      btn.className = `message-btn ${msg.type}`;
      btn.innerHTML = `
        <span class="btn-text">${msg.text.replace(/{name}/g, '<strong>little one</strong>')}</span>
        <span style="font-size: 30px;">${msg.emoji}</span>
      `;
      btn.onclick = () => speakMessage(msg.text);
      
      // Add hover sound effect
      btn.addEventListener('mouseenter', () => {
        if (!btn.disabled) playSleighBell();
      });
      
      messageButtonsContainer.appendChild(btn);
    });

    document.getElementById('childName').addEventListener('input', updateButtonText);

    // Auto-fill name across all sections
    document.getElementById('childName').addEventListener('input', function() {
      const name = this.value;
      updateButtonText(); // Update soundboard buttons
      
      // Update letter name if empty
      const letterNameInput = document.getElementById('letterName');
      if (letterNameInput) {
        letterNameInput.value = name;
      }
      
      // Update elf name input if empty
      const elfNameInput = document.getElementById('elfNameInput');
      if (elfNameInput) {
        elfNameInput.value = name;
      }
    });

    // ElevenLabs via serverless endpoint: /api/santa-voice
    async function speakMessage(text) {
      const name = (document.getElementById('childName').value || '').trim() || 'little one';
      const personalized = text.replace(/{name}/g, name);

      if (currentAudio) { currentAudio.pause(); currentAudio = null; }

      const buttons = document.querySelectorAll('.message-btn');
      buttons.forEach(b => b.disabled = true);
      const indicator = document.getElementById('speakingIndicator');
      indicator.style.display = 'block';

      try {
        const response = await fetch('/api/santa-voice', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text: personalized })
        });

        if (!response.ok) {
          const detail = await response.text().catch(()=>'');
          throw new Error(`API Error: ${response.status} ${response.statusText}\n${detail}`);
        }

        const audioBlob = await response.blob();
        const audioUrl = URL.createObjectURL(audioBlob);

        currentAudio = new Audio(audioUrl);
        currentAudio.onended = () => {
          indicator.style.display = 'none';
          buttons.forEach(b => b.disabled = false);
          currentAudio = null;
        };
        currentAudio.onerror = () => {
          indicator.style.display = 'none';
          buttons.forEach(b => b.disabled = false);
          alert('Error playing audio.');
        };

        await currentAudio.play();
      } catch (err) {
        console.error('Error generating Santa voice:', err);
        indicator.style.display = 'none';
        buttons.forEach(b => b.disabled = false);
        alert('Error generating Santa voice. Please try again.\n\n' + (err?.message || err));
      }
    }

    /**************  REPORT CARD  **************/
    function generateReport() {
      playMagicSparkle(); // Sound effect when generating
      
      const name = (document.getElementById('childName').value || '').trim() || 'this child';
      const niceScore = Math.floor(Math.random() * 40) + 60;
      const naughtyScore = 100 - niceScore;
      const status = niceScore >= 75 ? 'NICE LIST' : niceScore >= 60 ? 'WATCH LIST' : 'NAUGHTY LIST';
      const statusEmoji = niceScore >= 75 ? '‚≠ê' : niceScore >= 60 ? '‚ö†Ô∏è' : 'üéÖ';

      const allGoodDeeds = [
        'Shared toys with siblings','Helped with chores without being asked','Was kind to classmates',
        'Did homework on time','Cleaned their room','Said please and thank you','Helped a friend in need',
        'Was respectful to adults','Took care of a pet','Made their bed every morning','Ate vegetables without complaining',
        'Brushed teeth without reminders','Helped carry groceries','Shared snacks with others','Was patient while waiting',
        'Used kind words','Helped set the dinner table','Picked up after themselves','Was a good sport in games','Showed empathy to others'
      ];
      const allNaughtyDeeds = [
        'Argued with siblings','Didn\'t listen the first time','Left toys scattered around','Complained about bedtime',
        'Forgot to do assigned chores','Talked back occasionally','Needed reminders to clean up','Interrupted adults talking',
        'Was grumpy in the morning','Fought over screen time','Didn\'t finish dinner','Procrastinated on homework',
        'Made excuses for mistakes','Whined about going outside','Refused to share sometimes','Was too rough with pets',
        'Stayed up past bedtime','Complained about chores','Left wet towels on the floor','Needed multiple reminders'
      ];

      const goodDeeds = [...allGoodDeeds].sort(()=>0.5-Math.random()).slice(0,4);
      const naughtyDeeds = [...allNaughtyDeeds].sort(()=>0.5-Math.random()).slice(0, Math.floor(Math.random()*2)+2);

      // Play success sound after a short delay
      setTimeout(() => playSuccess(), 300);

      document.getElementById('reportResult').innerHTML = `
        <div class="report-card">
          <div class="report-header">
            <div style="font-size:40px; margin-bottom:8px;">üéÑ</div>
            <h2 style="font-size:24px; font-weight:bold;">OFFICIAL SANTA REPORT</h2>
            <p style="font-size:14px; margin-top:4px;">North Pole ‚Ä¢ ${new Date().toLocaleDateString()}</p>
          </div>
          <div class="report-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
              <h3 style="font-size:24px; font-weight:bold;">${name}</h3>
              <span style="background:${status.includes('NICE') ? '#10b981' : status.includes('WATCH') ? '#fbbf24' : '#ef4444'}; color:white; padding:8px 16px; border-radius:20px; font-weight:bold; font-size:12px;">
                ${statusEmoji} ${status}
              </span>
            </div>
            <div class="report-scores">
              <div class="score-box nice">
                <div class="score-number" style="color:#059669;">${niceScore}%</div>
                <div style="font-size:14px; font-weight:600; color:#059669;">Nice Score</div>
              </div>
              <div class="score-box naughty">
                <div class="score-number" style="color:#dc2626;">${naughtyScore}%</div>
                <div style="font-size:14px; font-weight:600; color:#dc2626;">Naughty Score</div>
              </div>
            </div>
            <div class="deeds-section">
              <h4 style="font-weight:bold; margin-bottom:8px;">‚≠ê Good Deeds</h4>
              ${goodDeeds.map(d => `<div>‚úì ${d}</div>`).join('')}
            </div>
            <div class="deeds-section">
              <h4 style="font-weight:bold; margin-bottom:8px;">‚ö†Ô∏è Areas to Improve</h4>
              ${naughtyDeeds.map(d => `<div>‚Ä¢ ${d}</div>`).join('')}
            </div>
            <p style="text-align:center; font-size:12px; color:#6b7280; margin-top:16px; font-style:italic;">
              Report generated by Santa's Elf Monitoring System‚Ñ¢
            </p>
          </div>
        </div>
      `;
    }

    /**************  LETTER TO SANTA  **************/
    function saveLetterLocally() {
      let name = document.getElementById('letterName').value.trim();
      const content = document.getElementById('letterContent').value.trim();
      
      // Use main name if letter name is empty
      if (!name) {
        name = document.getElementById('childName').value.trim();
      }
      
      if (!name || !content) {
        alert('Please fill in both your name and letter content!');
        return;
      }
      
      playSuccess(); // Sound effect on save
      
      const letterText = `Letter to Santa from ${name}\n${new Date().toLocaleDateString()}\n\n${content}`;
      const blob = new Blob([letterText], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `Letter_to_Santa_${name.replace(/\s+/g, '_')}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showLetterStatus('üíæ Letter saved to your device!', '#3b82f6');
    }
    
    function sendLetterToSanta() {
      let name = document.getElementById('letterName').value.trim();
      const content = document.getElementById('letterContent').value.trim();
      
      // Use main name if letter name is empty
      if (!name) {
        name = document.getElementById('childName').value.trim();
      }
      
      if (!name || !content) {
        alert('Please fill in both your name and letter content!');
        return;
      }
      
      playMagicSparkle(); // Sound effect when sending
      
      showLetterStatus('üìÆ Sending to the North Pole...', '#fbbf24');
      
      setTimeout(() => {
        playSuccess(); // Success sound when delivered
        showLetterStatus(`
          <div style="text-align: center;">
            <div style="font-size: 64px; margin-bottom: 16px; animation: bounce 1s ease-in-out;">üéÖ‚ú®</div>
            <h3 style="font-size: 24px; font-weight: bold; color: #059669; margin-bottom: 8px;">Letter Delivered!</h3>
            <p style="font-size: 16px; color: #374151;">Santa has received your letter, ${name}!</p>
            <p style="font-size: 14px; color: #6b7280; margin-top: 8px;">He's checking it twice and adding it to his special list. üéÑ</p>
          </div>
        `, 'linear-gradient(135deg, #d1fae5, #a7f3d0)');
        
        setTimeout(() => {
          document.getElementById('letterName').value = '';
          document.getElementById('letterContent').value = '';
        }, 2000);
      }, 2000);
    }
    
    function showLetterStatus(message, bgColor) {
      const statusDiv = document.getElementById('letterStatus');
      statusDiv.innerHTML = `
        <div style="background: ${bgColor}; color: #1f2937; border-radius: 16px; padding: 20px; text-align: center; font-weight: 600;">
          ${message}
        </div>
      `;
      statusDiv.style.display = 'block';
    }

    /**************  ELF NAME GENERATOR  **************/
    function generateElfName() {
      let name = document.getElementById('elfNameInput').value.trim();
      
      // Use main name if elf name input is empty
      if (!name) {
        name = document.getElementById('childName').value.trim();
      }
      
      if (!name) {
        alert('Please enter your name in the name field at the top!');
        return;
      }

      playMagicSparkle(); // Sound effect when generating

      const prefixes = [
        'Sparkle', 'Jingle', 'Twinkle', 'Sugar', 'Jolly', 'Merry', 'Cocoa', 'Candy',
        'Ginger', 'Snowflake', 'Peppermint', 'Holly', 'Frosty', 'Tinsel', 'Glitter',
        'Cinnamon', 'Cookie', 'Mistletoe', 'Starlight', 'Chestnut', 'Nutmeg', 'Angel',
        'Berry', 'Sparkly', 'Cheery', 'Snowy', 'Elfie', 'Pudding', 'Caramel', 'Zippy'
      ];

      const suffixes = [
        'toes', 'bells', 'shine', 'plum', 'whiskers', 'bright', 'flakes', 'paws',
        'nose', 'sparkle', 'jingles', 'cheeks', 'buttons', 'wings', 'giggles',
        'twirl', 'bounce', 'dash', 'frost', 'sweet', 'star', 'berry', 'shoes',
        'hat', 'ears', 'glow', 'hop', 'skip', 'jump', 'smile'
      ];

      const titles = [
        'Chief Toy Inspector', 'Master Gift Wrapper', 'Head Cookie Taster',
        'Lead Reindeer Trainer', 'Senior Sleigh Engineer', 'Top Tinsel Arranger',
        'Premier Present Sorter', 'Chief Snow Sculptor', 'Master List Checker',
        'Head Jingle Composer', 'Lead Stocking Stuffer', 'Senior Candy Cane Maker',
        'Top Ornament Designer', 'Chief Wish Granter', 'Master Elf Motivator',
        'Head Chimney Navigator', 'Lead Magic Distributor', 'Senior Joy Spreader'
      ];

      // Generate consistent name based on input
      const nameHash = name.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
      const prefix = prefixes[nameHash % prefixes.length];
      const suffix = suffixes[(nameHash * 7) % suffixes.length];
      const title = titles[(nameHash * 13) % titles.length];
      const elfNumber = (nameHash % 999) + 1;

      const elfName = `${prefix}${suffix}`;
      
      // Play success sound after brief delay
      setTimeout(() => playSuccess(), 200);
      
      const resultDiv = document.getElementById('elfNameResult');
      resultDiv.innerHTML = `
        <div style="background: linear-gradient(135deg, #d1fae5, #a7f3d0); padding: 24px; border-radius: 16px; text-align: center; animation: bounce 0.5s ease-out;">
          <div style="font-size: 48px; margin-bottom: 12px;">üßù‚Äç‚ôÇÔ∏è‚ú®</div>
          <h3 style="font-size: 14px; color: #059669; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">Your Official Elf Name</h3>
          <div style="font-size: 32px; font-weight: bold; color: #16a34a; margin-bottom: 8px;">${elfName}</div>
          <div style="background: white; padding: 12px; border-radius: 12px; margin: 16px 0;">
            <p style="font-size: 14px; color: #6b7280; margin-bottom: 4px;">Official Title:</p>
            <p style="font-size: 18px; font-weight: 600; color: #374151;">${title}</p>
          </div>
          <div style="display: inline-block; background: #16a34a; color: white; padding: 8px 16px; border-radius: 20px; font-size: 12px; font-weight: 600;">
            ELF #${String(elfNumber).padStart(3, '0')}
          </div>
          <p style="font-size: 12px; color: #6b7280; margin-top: 16px; font-style: italic;">
            Welcome to Santa's Workshop, ${elfName}! üéÑ
          </p>
        </div>
      `;
      resultDiv.style.display = 'block';
    }

    /**************  ADVENT CALENDAR  **************/
    const adventSurprises = [
      { icon: 'üéÖ', title: 'Santa Fact', content: 'Santa has over 2 billion children to visit on Christmas Eve!' },
      { icon: 'ü¶å', title: 'Reindeer Fact', content: 'Rudolph was almost named Rollo or Reginald!' },
      { icon: 'üç™', title: 'Cookie Recipe', content: 'Santa\'s favorite cookies are chocolate chip with a glass of cold milk!' },
      { icon: '‚õÑ', title: 'Snowman Joke', content: 'What do snowmen eat for breakfast? Frosted Flakes!' },
      { icon: 'üéÑ', title: 'Tree Fact', content: 'The tradition of Christmas trees started in Germany over 400 years ago!' },
      { icon: 'üéÅ', title: 'Gift Fact', content: 'The biggest Christmas gift ever was the Statue of Liberty from France!' },
      { icon: 'üîî', title: 'Jingle Bells', content: 'Jingle Bells was originally written for Thanksgiving, not Christmas!' },
      { icon: 'üßù', title: 'Elf Fact', content: 'Santa\'s elves work in 8-hour shifts around the clock making toys!' },
      { icon: '‚ú®', title: 'North Pole Fact', content: 'The North Pole temperature can drop to -40¬∞F in winter!' },
      { icon: 'üéÖ', title: 'Santa\'s Age', content: 'Santa Claus is over 1,750 years old!' },
      { icon: 'ü•õ', title: 'Milk & Cookies', content: 'Children around the world leave out over 500 million cookies for Santa!' },
      { icon: 'üéµ', title: 'Carol Fact', content: 'Silent Night has been translated into over 300 languages!' },
      { icon: '‚≠ê', title: 'Christmas Star', content: 'The star on top of the tree represents the Star of Bethlehem!' },
      { icon: 'üß¶', title: 'Stocking Fact', content: 'The tradition of stockings came from a generous gift from St. Nicholas!' },
      { icon: 'üé™', title: 'Toy Fact', content: 'The most popular toy requested from Santa is LEGO bricks!' },
      { icon: '‚ùÑÔ∏è', title: 'Snow Fact', content: 'No two snowflakes are exactly alike!' },
      { icon: 'üç¨', title: 'Candy Cane', content: 'Candy canes were originally made to keep children quiet in church!' },
      { icon: 'üé∫', title: 'Music Fact', content: 'The song "Jingle Bells" was the first song played in space!' },
      { icon: 'üåü', title: 'Wish Upon a Star', content: 'Santa grants wishes to children who believe with all their heart!' },
      { icon: 'üéâ', title: 'Celebration', content: 'Over 2 billion people celebrate Christmas worldwide!' },
      { icon: 'üïØÔ∏è', title: 'Candle Fact', content: 'Candles on Christmas trees were used before electric lights!' },
      { icon: 'üéÄ', title: 'Wrapping Fact', content: 'Americans spend over $2 billion on Christmas wrapping paper!' },
      { icon: 'üè†', title: 'Gingerbread', content: 'Gingerbread houses started in Germany in the 1800s!' },
      { icon: 'üéä', title: 'Almost Christmas!', content: 'Only 1 day left! Santa is packing his sleigh right now!' },
      { icon: 'üéÖ', title: 'MERRY CHRISTMAS!', content: 'It\'s Christmas Day! Santa visited last night while you were sleeping! üéÑ‚ú®' }
    ];

    function initAdventCalendar() {
      const grid = document.getElementById('adventGrid');
      const now = new Date();
      const currentMonth = now.getMonth();
      const currentDay = now.getDate();
      
      // Get opened days from localStorage
      const openedDays = JSON.parse(localStorage.getItem('adventOpened') || '[]');
      
      for (let day = 1; day <= 25; day++) {
        const dayDiv = document.createElement('div');
        dayDiv.className = 'advent-day';
        
        const isOpened = openedDays.includes(day);
        const isDecember = currentMonth === 11; // December is month 11
        const canOpen = isDecember && currentDay >= day;
        const isToday = isDecember && currentDay === day;
        
        if (!canOpen) {
          dayDiv.classList.add('locked');
        } else if (isOpened) {
          dayDiv.classList.add('opened');
        }
        
        if (isToday && !isOpened) {
          dayDiv.classList.add('today');
        }
        
        dayDiv.innerHTML = `
          <div class="advent-number">${day}</div>
          <div class="advent-icon">${isOpened ? '‚ú®' : canOpen ? 'üéÅ' : 'üîí'}</div>
        `;
        
        if (canOpen && !isOpened) {
          dayDiv.onclick = () => openAdventDay(day);
        }
        
        grid.appendChild(dayDiv);
      }
    }

    function openAdventDay(day) {
      playMagicSparkle(); // Sound effect when opening
      
      const surprise = adventSurprises[day - 1];
      const modal = document.getElementById('adventModal');
      const content = document.getElementById('adventSurpriseContent');
      
      content.innerHTML = `
        <div class="advent-surprise">${surprise.icon}</div>
        <h2 style="font-size: 28px; font-weight: bold; color: #dc2626; margin-bottom: 12px;">Day ${day}</h2>
        <h3 style="font-size: 22px; font-weight: 600; color: #16a34a; margin-bottom: 16px;">${surprise.title}</h3>
        <p style="font-size: 18px; color: #374151; line-height: 1.6;">${surprise.content}</p>
        <button onclick="closeAdventModal()" style="margin-top: 24px; padding: 12px 32px; background: linear-gradient(135deg, #dc2626, #16a34a); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer;">
          Close
        </button>
      `;
      
      modal.classList.add('open');
      
      // Play success sound after brief delay
      setTimeout(() => playSuccess(), 200);
      
      // Mark as opened
      const openedDays = JSON.parse(localStorage.getItem('adventOpened') || '[]');
      if (!openedDays.includes(day)) {
        openedDays.push(day);
        localStorage.setItem('adventOpened', JSON.stringify(openedDays));
      }
      
      // Refresh calendar to show opened state
      document.getElementById('adventGrid').innerHTML = '';
      initAdventCalendar();
    }

    function closeAdventModal() {
      document.getElementById('adventModal').classList.remove('open');
    }

    // Initialize advent calendar when page loads
    initAdventCalendar();

    /**************  SANTA CAM  **************/
    let camManifest = null;

    async function loadCamManifest() {
      if (camManifest) return camManifest;
      const res = await fetch('/videos/index.json', { cache: 'no-store' });
      if (!res.ok) throw new Error('Failed to load videos manifest');
      camManifest = await res.json();
      return camManifest;
    }

    async function openCam(key) {
      playJingleBell(); // Sound effect when opening camera
      
      const modal = document.getElementById('videoModal');
      const video = document.getElementById('modalVideo');
      const title = document.getElementById('modalTitle');
      const muteBtn = document.getElementById('muteBtn');

      const manifest = await loadCamManifest();
      const scene = manifest[key];
      if (!scene || !Array.isArray(scene.files) || scene.files.length === 0) {
        alert('No videos found for this scene yet.');
        return;
      }
      
      const choice = scene.files[Math.floor(Math.random() * scene.files.length)];
      const src = `${(scene.base || '').replace(/\/$/, '')}/${choice}`;
      
      try { video.pause(); } catch {}
      video.removeAttribute('src');
      video.innerHTML = '';
      video.load();
      
      const source = document.createElement('source');
      source.src = src;
      source.type = 'video/mp4';
      video.appendChild(source);
      
      title.textContent = scene.title || 'Santa Cam';
      video.muted = false;
      muteBtn.textContent = 'üîä Mute';
      modal.classList.add('open');
      
      video.play().catch(() => {
        video.muted = true;
        muteBtn.textContent = 'üîá Unmute';
        video.play().catch(() => {
          alert('This video format may not be supported by the browser.');
        });
      });
      
      video.onerror = () => {
        console.warn('Video error; check path/codec:', src);
      };
    }

    function toggleMute() {
      const video = document.getElementById('modalVideo');
      const muteBtn = document.getElementById('muteBtn');
      video.muted = !video.muted;
      muteBtn.textContent = video.muted ? 'üîá Unmute' : 'üîä Mute';
    }

    function restartVideo() {
      const video = document.getElementById('modalVideo');
      video.currentTime = 0;
      video.play().catch(()=>{});
    }

    function closeModal() {
      const modal = document.getElementById('videoModal');
      const video = document.getElementById('modalVideo');
      try { video.pause(); } catch {}
      modal.classList.remove('open');
    }

    document.getElementById('videoModal').addEventListener('click', (e) => {
      if (e.target.id === 'videoModal') closeModal();
    });

    /**************  HIDE ADVENT TAB UNTIL DEC 1 **************/
    (function hideAdventTabUntilDecember() {
      const now = new Date();
      // Show the advent calendar only from December 1st onwards (month 11 in zero-based index)
      if (!(now.getMonth() === 11 && now.getDate() >= 1)) {
        const adventTab = document.getElementById('adventTab');
        if (adventTab) {
          adventTab.style.display = 'none';
        }
      }
    })();

    /* Override sound effect functions to disable them */
    function playJingleBell() {}
    function playSleighBell() {}
    function playHoHoHo() {}
    function playMagicSparkle() {}
    function playSuccess() {}

    /************** DAILY TIDBIT **************/
    const CHRISTMAS_JOKES = [
      "Why did Santa go to music school? Because he wanted to improve his wrapping skills!",
      "What do snowmen eat for breakfast? Frosted Flakes!",
      "Why is it so cold at Christmas? Because it‚Äôs Decem-brrr!",
      "What do you call an elf that sings? A wrapper.",
      "Why did the turkey join the band? He had the drumsticks!",
      "What do you call a kid who doesn‚Äôt believe in Santa? A rebel without a Claus.",
      "How much did Santa pay for his sleigh? Nothing ‚Äî it was on the house!",
      "Why did the ornament go to school? It wanted to be a little brighter.",
      "What do you call a snowman with a six-pack? An abdominal snowman.",
      "Why did Santa‚Äôs helper see the doctor? He had low elf-esteem."
    ];
    const CHRISTMAS_FACTS = [
      "‚ÄúJingle Bells‚Äù was originally written for Thanksgiving, not Christmas.",
      "Rudolph almost had a different name: Rollo or Reginald were early options.",
      "Germany popularized Christmas trees in the 16th century.",
      "The largest gingerbread house ever built was over 21 feet tall.",
      "Candy canes were reportedly created to keep children quiet in church.",
      "The Statue of Liberty is the largest Christmas gift ever given (from France to the U.S.).",
      "The first artificial Christmas trees were made from dyed goose feathers in Germany.",
      "NORAD has tracked Santa on Christmas Eve since 1955 due to a misprinted phone number.",
      "The song ‚ÄúSilent Night‚Äù has been translated into 300+ languages.",
      "‚ÄúXmas‚Äù isn‚Äôt anti-Christmas‚Äî‚ÄúX‚Äù comes from the Greek letter Chi, the first letter of ‚ÄúChrist.‚Äù"
    ];
    function setDailyTidbit() {
      const today = new Date();
      const key = today.getFullYear() + '-' + String(today.getMonth()+1).padStart(2,'0') + '-' + String(today.getDate()).padStart(2,'0');
      let hash = 0;
      for (let i=0; i<key.length; i++) hash = ((hash << 5) - hash + key.charCodeAt(i)) >>> 0;
      const pool = CHRISTMAS_JOKES.concat(CHRISTMAS_FACTS);
      const pick = pool[hash % pool.length];
      const el = document.getElementById('dailyText');
      if (el) el.textContent = pick;
    }

    /************** NORTH POLE MAP **************/
    /*
      The original map implementation used a grid and an info modal to display
      descriptions about various North Pole locations. That approach felt
      disconnected from the Santa Cam experience. To make the map more exciting
      and interactive, the map markers now directly open the corresponding
      Santa Cam when clicked. The grid and info modal have been removed and
      are no longer used.
    */


    /************** ORNAMENT DESIGNER **************/
    let currentOrnamentShape = 'ball';
    // Add pattern state for ornaments. Patterns can be 'solid', 'striped', or 'dotted'.
    let currentOrnamentPattern = 'solid';

    // Handle selection of ornament patterns. Highlight the active button and update the preview.
    function selectOrnamentPattern(pattern) {
      currentOrnamentPattern = pattern;
      // Remove active state from all pattern buttons (including paint)
      ['patternSolid','patternStriped','patternDotted','patternPaint'].forEach(id => {
        const btn = document.getElementById(id);
        if (btn) btn.classList.remove('active');
      });
      // Compute button id by capitalizing first letter
      const activeBtnId = 'pattern' + pattern.charAt(0).toUpperCase() + pattern.slice(1);
      const activeBtn = document.getElementById(activeBtnId);
      if (activeBtn) activeBtn.classList.add('active');
      // Show or hide brush size slider based on pattern
      const brushLabel = document.getElementById('brushSizeLabel');
      if (brushLabel) {
        brushLabel.style.display = (pattern === 'paint' ? 'flex' : 'none');
      }
      updateOrnamentPreview();
    }
    function selectOrnamentShape(shape) {
      currentOrnamentShape = shape;
      ['shapeBall','shapeStar','shapeTree'].forEach(id => {
        const btn = document.getElementById(id);
        if (btn) btn.classList.remove('active');
      });
      const activeBtn = document.getElementById('shape' + shape.charAt(0).toUpperCase() + shape.slice(1));
      if (activeBtn) activeBtn.classList.add('active');
      updateOrnamentPreview();
    }
    function updateOrnamentPreview() {
      const svg = document.getElementById('ornamentPreview');
      if (!svg) return;
      const baseColor = document.getElementById('ornamentBaseColor')?.value || '#ef4444';
      const decoColor = document.getElementById('ornamentDecoColor')?.value || '#fbbf24';
      let baseShape = '';
      let clipPathDef = '';
      let overlay = '';
      // Construct base shape and clipping definition for patterns
      if (currentOrnamentShape === 'ball') {
        baseShape = '<circle cx="60" cy="80" r="50" fill="' + baseColor + '" stroke="' + decoColor + '" stroke-width="6" />';
        clipPathDef = '<clipPath id="ornamentClip"><circle cx="60" cy="80" r="50" /></clipPath>';
      } else if (currentOrnamentShape === 'star') {
        const starPts = '60,10 72,52 115,52 82,78 94,120 60,95 26,120 38,78 5,52 48,52';
        baseShape = '<polygon points="' + starPts + '" fill="' + baseColor + '" stroke="' + decoColor + '" stroke-width="6" />';
        clipPathDef = '<clipPath id="ornamentClip"><polygon points="' + starPts + '" /></clipPath>';
      } else if (currentOrnamentShape === 'tree') {
        // tree made of two triangles and a trunk; combine for clip path
        baseShape = '<polygon points="60,20 95,80 25,80" fill="' + baseColor + '" stroke="' + decoColor + '" stroke-width="6" />' +
                    '<polygon points="60,60 100,120 20,120" fill="' + baseColor + '" stroke="' + decoColor + '" stroke-width="6" />' +
                    '<rect x="50" y="120" width="20" height="30" fill="' + decoColor + '" />';
        clipPathDef = '<clipPath id="ornamentClip">' +
                      '<polygon points="60,20 95,80 25,80" />' +
                      '<polygon points="60,60 100,120 20,120" />' +
                      '<rect x="50" y="120" width="20" height="30" />' +
                      '</clipPath>';
      }
      // Add overlay based on selected pattern
      if (currentOrnamentPattern === 'striped') {
        // Horizontal stripes across the ornament
        overlay = '<g clip-path="url(#ornamentClip)">' +
                  '<rect x="0" y="40" width="120" height="10" fill="' + decoColor + '" />' +
                  '<rect x="0" y="80" width="120" height="10" fill="' + decoColor + '" />' +
                  '<rect x="0" y="120" width="120" height="10" fill="' + decoColor + '" />' +
                  '</g>';
      } else if (currentOrnamentPattern === 'dotted') {
        // Polka dots at preset positions within the shape
        overlay = '<g clip-path="url(#ornamentClip)">' +
                  '<circle cx="30" cy="60" r="5" fill="' + decoColor + '" />' +
                  '<circle cx="60" cy="90" r="5" fill="' + decoColor + '" />' +
                  '<circle cx="90" cy="70" r="5" fill="' + decoColor + '" />' +
                  '<circle cx="45" cy="115" r="5" fill="' + decoColor + '" />' +
                  '<circle cx="75" cy="120" r="5" fill="' + decoColor + '" />' +
                  '</g>';
      } else if (currentOrnamentPattern === 'paint') {
        // Paint pattern: draw random brush strokes clipped to the ornament shape
        const brushSize = parseInt(document.getElementById('ornamentBrushSize')?.value || '4', 10);
        let strokes = '';
        // Generate a number of random strokes proportional to the shape size
        for (let i = 0; i < 12; i++) {
          const x1 = (Math.random() * 120).toFixed(1);
          const y1 = (Math.random() * 160).toFixed(1);
          const x2 = (parseFloat(x1) + (Math.random() * 30 - 15)).toFixed(1);
          const y2 = (parseFloat(y1) + (Math.random() * 30 - 15)).toFixed(1);
          strokes += '<line x1="' + x1 + '" y1="' + y1 + '" x2="' + x2 + '" y2="' + y2 + '" stroke="' + decoColor + '" stroke-width="' + brushSize + '" stroke-linecap="round" />';
        }
        overlay = '<g clip-path="url(#ornamentClip)">' + strokes + '</g>';
      } else {
        // Solid pattern: no overlay
        overlay = '';
      }
      // Combine definitions and shapes
      const defs = '<defs>' + clipPathDef + '</defs>';
      svg.innerHTML = defs + baseShape + overlay;
    }

    /************** INTERACTIVE MAP **************/
    function initInteractiveMap() {
      const mapEl = document.getElementById('interactiveMap');
      if (!mapEl) return;
      mapEl.innerHTML = '';
      const markers = [
        { key:'workshop', icon:'üéÅ', label:'Workshop', x:20, y:30 },
        { key:'office', icon:'üìã', label:'Office', x:70, y:25 },
        { key:'stable', icon:'ü¶å', label:'Stable', x:30, y:75 },
        { key:'kitchen', icon:'üç™', label:'Kitchen', x:80, y:60 },
        { key:'mailroom', icon:'‚úâÔ∏è', label:'Mail Room', x:50, y:50 },
        { key:'lab', icon:'üß∏', label:'Toy Lab', x:15, y:60 }
      ];
      markers.forEach(marker => {
        const el = document.createElement('div');
        el.className = 'map-marker';
        el.style.left = marker.x + '%';
        el.style.top = marker.y + '%';
        el.innerHTML = '<div class="marker-icon">' + marker.icon + '</div><div class="marker-label">' + marker.label + '</div>';
        el.onclick = () => openCam(marker.key);
        mapEl.appendChild(el);
      });
    }

    /************** SNOW GLOBE EXPLORER **************/
    function initSnowGlobes() {
      const grid = document.getElementById('globeGrid');
      if (!grid) return;
      grid.innerHTML = '';
      const locations = [
        { key: 'workshop', name: 'Workshop', emoji: 'üéÅ' },
        { key: 'office', name: 'Office', emoji: 'üìã' },
        { key: 'stable', name: 'Stable', emoji: 'ü¶å' },
        { key: 'kitchen', name: 'Kitchen', emoji: 'üç™' },
        { key: 'mailroom', name: 'Mail Room', emoji: '‚úâÔ∏è' },
        { key: 'lab', name: 'Toy Lab', emoji: 'üß∏' }
      ];
      locations.forEach(loc => {
        const globe = document.createElement('div');
        globe.className = 'snow-globe';
        globe.onclick = () => openCam(loc.key);
        const inner = document.createElement('div');
        inner.className = 'globe-inner';
        // Create snow dots
        for (let i = 0; i < 15; i++) {
          const dot = document.createElement('div');
          dot.className = 'snow-dot';
          dot.style.left = Math.random() * 100 + '%';
          dot.style.top = Math.random() * 100 + '%';
          dot.style.animationDuration = (3 + Math.random() * 5) + 's';
          dot.style.animationDelay = (-Math.random() * 5) + 's';
          inner.appendChild(dot);
        }
        // Add emoji inside the globe
        const emojiSpan = document.createElement('div');
        emojiSpan.style.fontSize = '32px';
        emojiSpan.style.position = 'absolute';
        emojiSpan.style.left = '50%';
        emojiSpan.style.top = '45%';
        emojiSpan.style.transform = 'translate(-50%, -50%)';
        emojiSpan.textContent = loc.emoji;
        inner.appendChild(emojiSpan);
        // Label beneath the globe
        const label = document.createElement('div');
        label.className = 'globe-label';
        label.textContent = loc.name;
        globe.appendChild(inner);
        globe.appendChild(label);
        grid.appendChild(globe);
      });
    }

    /************** COOKIE DECORATOR **************/
    let currentCookieShape = 'round';
    let currentCookiePattern = 'solid';
    function selectCookieShape(shape) {
      currentCookieShape = shape;
      ['cookieShapeRound','cookieShapeStar','cookieShapeTree'].forEach(id => {
        const btn = document.getElementById(id);
        if (btn) btn.classList.remove('active');
      });
      const id = shape === 'round' ? 'cookieShapeRound' : shape === 'star' ? 'cookieShapeStar' : 'cookieShapeTree';
      const activeBtn = document.getElementById(id);
      if (activeBtn) activeBtn.classList.add('active');
      updateCookiePreview();
    }
    function selectCookiePattern(pattern) {
      currentCookiePattern = pattern;
      ['cookiePatternSolid','cookiePatternStriped','cookiePatternDotted'].forEach(id => {
        const btn = document.getElementById(id);
        if (btn) btn.classList.remove('active');
      });
      const id = pattern === 'solid' ? 'cookiePatternSolid' : pattern === 'striped' ? 'cookiePatternStriped' : 'cookiePatternDotted';
      const activeBtn = document.getElementById(id);
      if (activeBtn) activeBtn.classList.add('active');
      updateCookiePreview();
    }
    function updateCookiePreview() {
      const svg = document.getElementById('cookiePreview');
      if (!svg) return;
      const baseColor = document.getElementById('cookieBaseColor')?.value || '#f5c16c';
      const frostColor = document.getElementById('cookieFrostColor')?.value || '#ffffff';
      let baseShape = '';
      let clipDef = '';
      if (currentCookieShape === 'round') {
        baseShape = '<circle cx="60" cy="80" r="50" fill="' + baseColor + '" />';
        clipDef = '<clipPath id="cookieClip"><circle cx="60" cy="80" r="50" /></clipPath>';
      } else if (currentCookieShape === 'star') {
        const starPts = '60,10 72,52 115,52 82,78 94,120 60,95 26,120 38,78 5,52 48,52';
        baseShape = '<polygon points="' + starPts + '" fill="' + baseColor + '" />';
        clipDef = '<clipPath id="cookieClip"><polygon points="' + starPts + '" /></clipPath>';
      } else {
        // tree shape
        baseShape = '<polygon points="60,20 95,80 25,80" fill="' + baseColor + '" />' +
                    '<polygon points="60,60 100,120 20,120" fill="' + baseColor + '" />' +
                    '<rect x="50" y="120" width="20" height="30" fill="' + baseColor + '" />';
        clipDef = '<clipPath id="cookieClip"><polygon points="60,20 95,80 25,80" /><polygon points="60,60 100,120 20,120" /><rect x="50" y="120" width="20" height="30" /></clipPath>';
      }
      let overlay = '';
      if (currentCookiePattern === 'striped') {
        overlay = '<g clip-path="url(#cookieClip)">' +
                  '<rect x="0" y="40" width="120" height="10" fill="' + frostColor + '" />' +
                  '<rect x="0" y="80" width="120" height="10" fill="' + frostColor + '" />' +
                  '<rect x="0" y="120" width="120" height="10" fill="' + frostColor + '" />' +
                  '</g>';
      } else if (currentCookiePattern === 'dotted') {
        overlay = '<g clip-path="url(#cookieClip)">' +
                  '<circle cx="30" cy="60" r="5" fill="' + frostColor + '" />' +
                  '<circle cx="60" cy="90" r="5" fill="' + frostColor + '" />' +
                  '<circle cx="90" cy="70" r="5" fill="' + frostColor + '" />' +
                  '<circle cx="45" cy="115" r="5" fill="' + frostColor + '" />' +
                  '<circle cx="75" cy="120" r="5" fill="' + frostColor + '" />' +
                  '</g>';
      } else {
        overlay = '';
      }
      const defs = '<defs>' + clipDef + '</defs>';
      svg.innerHTML = defs + baseShape + overlay;
    }
    function saveCookieLocally() {
      const svgEl = document.getElementById('cookiePreview');
      if (!svgEl) return;
      const svgData = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 160">' + svgEl.innerHTML + '</svg>';
      const blob = new Blob([svgData], { type: 'image/svg+xml' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'custom_cookie.svg';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    /************** REINDEER RACE **************/
    const reindeerNames = ['Dasher','Dancer','Prancer','Vixen','Comet','Cupid','Donner','Blitzen','Rudolph'];
    // User's selected reindeer. When null, no reindeer has been chosen yet.
    let selectedReindeer = null;
    function buildReindeerRace() {
      const container = document.getElementById('raceContainer');
      if (!container) return;
      container.innerHTML = '';
      reindeerNames.forEach(name => {
        const row = document.createElement('div');
        row.className = 'race-row';
        const icon = document.createElement('div');
        icon.className = 'race-icon';
        icon.textContent = 'ü¶å';
        const track = document.createElement('div');
        track.className = 'race-track';
        const progress = document.createElement('div');
        progress.className = 'race-progress';
        track.appendChild(progress);
        row.appendChild(icon);
        row.appendChild(track);
        container.appendChild(row);
      });
    }
    }

    /**
     * Populate the reindeer selection area with buttons.  Each button allows
     * the user to choose a favorite reindeer before starting the race.  The
     * selected button receives an `.active` class to indicate selection.
     */
    function buildReindeerSelect() {
      const selectContainer = document.getElementById('reindeerSelect');
      if (!selectContainer) return;
      selectContainer.innerHTML = '';
      reindeerNames.forEach(name => {
        const btn = document.createElement('button');
        btn.textContent = name;
        btn.onclick = () => {
          selectedReindeer = name;
          // Highlight the selected button
          const allBtns = selectContainer.querySelectorAll('button');
          allBtns.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
        };
        selectContainer.appendChild(btn);
      });
    }
    let raceInProgress = false;
    function startReindeerRace() {
      if (raceInProgress) return;
      raceInProgress = true;
      const resultEl = document.getElementById('raceResult');
      if (resultEl) resultEl.textContent = '';
      const rows = Array.from(document.querySelectorAll('.race-row'));
      const results = [];
      let finished = 0;
      rows.forEach((row, idx) => {
        const progress = row.querySelector('.race-progress');
        if (!progress) return;
        progress.style.width = '0%';
        const duration = Math.random() * 8000 + 4000;
        progress.style.transition = 'width ' + duration + 'ms linear';
        setTimeout(() => {
          progress.style.width = '100%';
        }, 50);
        progress.addEventListener('transitionend', function handler() {
          progress.removeEventListener('transitionend', handler);
          results.push({ name: reindeerNames[idx], time: duration });
          finished++;
          if (finished === rows.length) {
            // Sort results by ascending time to determine finishing order
            results.sort((a, b) => a.time - b.time);
            const winner = results[0].name;
            if (resultEl) {
              // If the user chose a reindeer, include their placement in the message
              if (selectedReindeer) {
                const pos = results.findIndex(r => r.name === selectedReindeer) + 1;
                if (winner === selectedReindeer) {
                  resultEl.textContent = 'You chose ' + selectedReindeer + ' and they won the race!';
                } else {
                  // ordinal suffix helper
                  const ordinal = (n) => {
                    const mod10 = n % 10, mod100 = n % 100;
                    if (mod10 === 1 && mod100 !== 11) return n + 'st';
                    if (mod10 === 2 && mod100 !== 12) return n + 'nd';
                    if (mod10 === 3 && mod100 !== 13) return n + 'rd';
                    return n + 'th';
                  };
                  resultEl.textContent = winner + ' wins the race! Your reindeer ' + selectedReindeer + ' came in ' + ordinal(pos) + ' place.';
                }
              } else {
                resultEl.textContent = winner + ' wins the race!';
              }
            }
            raceInProgress = false;
          }
        });
      });
    }

    /************** SNOWFLAKE MAKER **************/
    let currentSnowflakeTemplate = 'simple';
    function selectSnowflakeTemplate(template) {
      currentSnowflakeTemplate = template;
      ['flakeSimple','flakeStar','flakePetal'].forEach(id => {
        const btn = document.getElementById(id);
        if (btn) btn.classList.remove('active');
      });
      const id = template === 'simple' ? 'flakeSimple' : template === 'star' ? 'flakeStar' : 'flakePetal';
      const active = document.getElementById(id);
      if (active) active.classList.add('active');
      updateSnowflakePreview();
    }
    function updateSnowflakePreview() {
      const svg = document.getElementById('snowflakePreview');
      if (!svg) return;
      const color = document.getElementById('flakeColor')?.value || '#60a5fa';
      const accent = document.getElementById('flakeAccentColor')?.value || '#ffffff';
      let content = '';
      if (currentSnowflakeTemplate === 'simple') {
        content = '<g stroke="' + color + '" stroke-width="4">' +
                  '<line x1="70" y1="20" x2="70" y2="140" />' +
                  '<line x1="20" y1="80" x2="120" y2="80" />' +
                  '<line x1="30" y1="35" x2="110" y2="125" />' +
                  '<line x1="110" y1="35" x2="30" y2="125" />' +
                  '</g>' +
                  '<g fill="' + accent + '">' +
                  '<circle cx="70" cy="20" r="5" />' +
                  '<circle cx="70" cy="140" r="5" />' +
                  '<circle cx="20" cy="80" r="5" />' +
                  '<circle cx="120" cy="80" r="5" />' +
                  '<circle cx="30" cy="35" r="5" />' +
                  '<circle cx="110" cy="125" r="5" />' +
                  '<circle cx="110" cy="35" r="5" />' +
                  '<circle cx="30" cy="125" r="5" />' +
                  '<circle cx="70" cy="80" r="4" />' +
                  '</g>';
      } else if (currentSnowflakeTemplate === 'star') {
        content = '<polygon points="70,20 78,55 115,55 84,75 92,110 70,90 48,110 56,75 25,55 62,55" fill="' + color + '" stroke="' + accent + '" stroke-width="3" />';
      } else {
        content = '<g fill="' + color + '">' +
                  '<ellipse cx="70" cy="40" rx="10" ry="25" />' +
                  '<ellipse cx="70" cy="120" rx="10" ry="25" />' +
                  '<ellipse cx="40" cy="80" rx="25" ry="10" />' +
                  '<ellipse cx="100" cy="80" rx="25" ry="10" />' +
                  '</g>' +
                  '<circle cx="70" cy="80" r="8" fill="' + accent + '" />';
      }
      svg.innerHTML = content;
    }
    function randomizeSnowflake() {
      const templates = ['simple','star','petal'];
      currentSnowflakeTemplate = templates[Math.floor(Math.random() * templates.length)];
      const colorInput = document.getElementById('flakeColor');
      const accentInput = document.getElementById('flakeAccentColor');
      if (colorInput) colorInput.value = '#' + Math.floor(Math.random() * 16777215).toString(16).padStart(6,'0');
      if (accentInput) accentInput.value = '#' + Math.floor(Math.random() * 16777215).toString(16).padStart(6,'0');
      selectSnowflakeTemplate(currentSnowflakeTemplate);
      updateSnowflakePreview();
    }
    function saveSnowflakeLocally() {
      const svgEl = document.getElementById('snowflakePreview');
      if (!svgEl) return;
      const svgData = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 140 160">' + svgEl.innerHTML + '</svg>';
      const blob = new Blob([svgData], { type: 'image/svg+xml' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'custom_snowflake.svg';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    /************** HOLIDAY QUIZ **************/
    const quizQuestions = [
      { question: 'Where does Santa Claus live?', options: ['South Pole','North Pole','Finland','Iceland'], answer: 1, explanation: 'Santa lives at the North Pole with Mrs. Claus and the elves.' },
      { question: 'What reindeer has a red nose?', options: ['Dasher','Prancer','Rudolph','Comet'], answer: 2, explanation: 'Rudolph the Red-Nosed Reindeer guides the sleigh with his shiny nose.' },
      { question: 'Which famous drink company popularized the modern image of Santa Claus?', options: ['Pepsi','Coca-Cola','Dr Pepper','Sprite'], answer: 1, explanation: 'Coca-Cola advertisements helped shape Santa‚Äôs red-suited image.' },
      { question: 'What do children traditionally leave out for Santa on Christmas Eve?', options: ['Candy canes','Fruitcake','Milk and cookies','Eggnog'], answer: 2, explanation: 'Milk and cookies are a classic treat for Santa.' },
      { question: 'Which holiday character famously steals Christmas?', options: ['Frosty','The Grinch','Jack Frost','Scrooge'], answer: 1, explanation: 'The Grinch tries to steal Christmas in Dr. Seuss‚Äôs story.' }
    ];
    let currentQuizIndex = 0;
    let quizScore = 0;
    function loadQuiz() {
      currentQuizIndex = 0;
      quizScore = 0;
      showQuizQuestion();
    }
    function showQuizQuestion() {
      const container = document.getElementById('quizContent');
      if (!container) return;
      container.innerHTML = '';
      if (currentQuizIndex >= quizQuestions.length) {
        const scoreEl = document.createElement('div');
        scoreEl.className = 'quiz-score';
        scoreEl.textContent = 'You scored ' + quizScore + ' out of ' + quizQuestions.length + '!';
        container.appendChild(scoreEl);
        const restartBtn = document.createElement('button');
        restartBtn.className = 'quiz-restart';
        restartBtn.textContent = 'Restart Quiz';
        restartBtn.onclick = () => { loadQuiz(); };
        container.appendChild(restartBtn);
        return;
      }
      const q = quizQuestions[currentQuizIndex];
      const qEl = document.createElement('div');
      qEl.className = 'quiz-question';
      qEl.textContent = q.question;
      container.appendChild(qEl);
      const optionsEl = document.createElement('div');
      optionsEl.className = 'quiz-options';
      q.options.forEach((opt, i) => {
        const btn = document.createElement('button');
        btn.textContent = opt;
        btn.onclick = () => { checkQuizAnswer(i); };
        optionsEl.appendChild(btn);
      });
      container.appendChild(optionsEl);
      const feedbackEl = document.createElement('div');
      feedbackEl.className = 'quiz-feedback';
      feedbackEl.id = 'quizFeedback';
      container.appendChild(feedbackEl);
    }
    function checkQuizAnswer(index) {
      const q = quizQuestions[currentQuizIndex];
      const feedbackEl = document.getElementById('quizFeedback');
      if (index === q.answer) {
        quizScore++;
        if (feedbackEl) {
          feedbackEl.textContent = 'Correct! ' + q.explanation;
          feedbackEl.style.color = '#10b981';
        }
      } else {
        if (feedbackEl) {
          feedbackEl.textContent = 'Oops! ' + q.explanation;
          feedbackEl.style.color = '#ef4444';
        }
      }
      currentQuizIndex++;
      setTimeout(() => {
        showQuizQuestion();
      }, 2000);
    }

    /************** SANTA TRACKER **************/
    let trackerInterval = null;
    const trackerStops = ['North Pole','Greenland','New York','London','Paris','Rome','Cairo','Tokyo','Sydney','Your Town'];
    function initTracker() {
      const msgEl = document.getElementById('trackerMessage');
      const statusEl = document.getElementById('trackerStatus');
      const progressEl = document.getElementById('trackerProgress');
      const now = new Date();
      const month = now.getMonth();
      const day = now.getDate();
      if (month === 11 && (day === 24 || day === 25)) {
        if (msgEl) msgEl.textContent = '';
        let index = 0;
        progressEl.style.width = '0%';
        statusEl.textContent = 'Santa is preparing his sleigh...';
        clearInterval(trackerInterval);
        trackerInterval = setInterval(() => {
          if (index < trackerStops.length) {
            const pct = Math.round((index / (trackerStops.length - 1)) * 100);
            progressEl.style.width = pct + '%';
            statusEl.textContent = 'Visiting ' + trackerStops[index];
            index++;
          } else {
            clearInterval(trackerInterval);
            statusEl.textContent = 'Santa has completed his journey!';
          }
        }, 4000);
      } else {
        if (progressEl) progressEl.style.width = '0%';
        if (statusEl) statusEl.textContent = '';
        if (msgEl) msgEl.textContent = 'Santa‚Äôs journey starts on December 24. Check back then!';
      }
    }

    /************** THEMES AND MUSIC **************/
    const themeStyles = {
      classic: 'linear-gradient(to bottom right, #450a0a, #7f1d1d, #14532d)',
      snowy: 'linear-gradient(to bottom right, #0f172a, #334155, #1e40af)',
      ginger: 'linear-gradient(to bottom right, #78350f, #92400e, #451a03)',
      candy: 'linear-gradient(to bottom right, #881337, #be123c, #db2777)'
    };
    function applyTheme(theme) {
      const style = themeStyles[theme];
      if (style) {
        document.body.style.background = style;
      }
    }
    // Background music functionality removed; themes now only change the page background.

    /************** ADVENT VISIBILITY **************/
    function setupAdventVisibility() {
      const now = new Date();
      const isDecember = now.getMonth() === 11;
      const adventTab = document.getElementById('adventTab');
      const adventPane = document.getElementById('advent');
      if (!isDecember) {
        if (adventTab) adventTab.style.display = 'none';
        if (adventPane) adventPane.style.display = 'none';
      } else {
        if (adventTab) adventTab.style.display = '';
        if (adventPane) adventPane.style.display = '';
      }
    }

    // Initialize custom features on page load
    setDailyTidbit();
    updateOrnamentPreview();
    updateCookiePreview();
    updateSnowflakePreview();
    initSnowGlobes();
    buildReindeerSelect();
    buildReindeerRace();
    loadQuiz();
    initTracker();
    setupAdventVisibility();
    // Set default theme
    applyTheme('classic');
  </script>
</body>
</html>
